# Example terraform.tfvars for GitLab Runner on AWS

project_name = "my-gitlab-runner"
aws_region   = "us-east-1"

# Network Configuration (optional - defaults to default VPC)
# vpc_id     = "vpc-xxxxxxxxx"
# subnet_ids = ["subnet-xxxxxxxxx", "subnet-yyyyyyyyy"]

# GitLab Configuration
gitlab_url   = "https://gitlab.com"
gitlab_token = "glrt-your-registration-token-here" # Get from GitLab: Settings > CI/CD > Runners
runner_tags  = "docker,linux,aws,spot"

# Instance Configuration
# ============================================================================
# ARM64 (Graviton) instances offer up to 40% cost savings vs x86-64
# See DOCKER_IMAGES.md for architecture-specific considerations
#
# x86-64 (Intel/AMD):
#   t3.medium  - 2 vCPU, 4GB RAM  ~$30/month spot
#   t3.large   - 2 vCPU, 8GB RAM  ~$60/month spot
#   c5.large   - 2 vCPU, 4GB RAM  ~$40/month spot (CPU-optimized)
#
# ARM64 (Graviton2/3):
#   t4g.medium - 2 vCPU, 4GB RAM  ~$18/month spot (40% savings!)
#   t4g.large  - 2 vCPU, 8GB RAM  ~$36/month spot (40% savings!)
#   c7g.large  - 2 vCPU, 4GB RAM  ~$24/month spot (CPU-optimized)
#
# All Docker images support both architectures automatically
# ============================================================================
instance_type       = "t3.medium" # 2 vCPU, 4 GB RAM
use_spot_instances  = true
spot_max_price      = "" # Empty for on-demand price
spot_instance_types = ["t3.medium", "t3a.medium", "t2.medium"]

# Scaling Configuration
min_size         = 0  # Scale to zero when idle
max_size         = 10
desired_capacity = 1

# Runner Configuration
runner_count_per_instance = 0 # 0 = auto-detect based on vCPU count

# Docker Image Configuration
# ============================================================================
# See DOCKER_IMAGES.md for complete profile documentation and cost analysis
#
# Available profiles:
#   latest     - Alias for 'full' (production default)
#   full       - Complete IaC toolchain (Terraform, OpenTofu, Terraspace, cloud CLIs, K8s, PowerShell) ~2.8GB
#   minimal    - Bare minimum (Git + sudo only, no Docker) ~400MB - ideal for compiled languages
#   k8s        - Kubernetes tools (kubectl, helm, kustomize, kubelogin) + Docker ~1.5GB
#   iac        - Infrastructure as Code (Terraform, OpenTofu, Terraspace, cloud CLIs) + Docker ~2.0GB
#   iac-pwsh   - IaC + PowerShell (adds Azure/AWS PowerShell modules) ~2.3GB
#
# Multi-architecture: Both x86-64 and ARM64 automatically detected
# Cost impact: Smaller profiles = faster startup + lower storage costs
#
# Examples by use case:
#   "fok666/gitlab-runner:full"     - Production (comprehensive tooling)
#   "fok666/gitlab-runner:minimal"  - Cost-optimized (simple builds, Go/Rust projects)
#   "fok666/gitlab-runner:k8s"      - Kubernetes deployments and GitOps
#   "fok666/gitlab-runner:iac"      - Terraform/OpenTofu without PowerShell
#   "fok666/gitlab-runner:iac-pwsh" - Terraform/OpenTofu with PowerShell automation
# ============================================================================
docker_image = "fok666/gitlab-runner:latest"

# Storage
root_volume_size = 100
root_volume_type = "gp3"

# Tags
tags = {
  Environment = "Production"
  Application = "GitLab-Runner"
  ManagedBy   = "Terraform"
  Team        = "DevOps"
}

# =============================================================================
# Production Features (Optional)
# =============================================================================

# Distributed Caching - Shared cache across ephemeral runners
# Significantly improves build performance (2-5x faster)
# Requires S3 bucket and IAM permissions
# Cost: ~$2-10/month for typical usage
# enable_distributed_cache  = true
# cache_s3_bucket_name      = "my-gitlab-runner-cache"
# cache_s3_bucket_region    = "us-east-1"  # Same as aws_region for best performance
# cache_shared              = true         # Share cache between all runners

# Centralized Logging - CloudWatch Logs integration
# Essential for troubleshooting ephemeral runners
# Requires IAM permissions for CloudWatch Logs
# Cost: ~$5-20/month for typical usage
# enable_centralized_logging = true
# log_group_name             = "/aws/gitlab-runner/production"
# log_retention_days         = 30  # 7, 30, 90, 365 days

# Runner Monitoring - Prometheus metrics endpoint
# Track job success rate, duration, queue depth
# Requires security group rule for metrics port
# Cost: Minimal (included in infrastructure)
# enable_runner_monitoring     = true
# metrics_port                 = 9252
# metrics_allowed_cidr_blocks  = ["10.0.0.0/16"]  # Your VPC CIDR
