# Example terraform.tfvars for GitHub Runner on Azure

project_name = "my-github-runner"
location     = "East US"

# GitHub Configuration
github_url   = "https://github.com/your-org/your-repo" # or https://github.com/your-org for organization
github_token = "your-registration-token-here"           # Get from GitHub: Settings > Actions > Runners > New self-hosted runner
runner_labels = "self-hosted,linux,x64,azure,spot"

# VM Configuration
# ============================================================================
# ARM64 (Ampere Altra) instances offer up to 50% cost savings vs x86-64
# See DOCKER_IMAGES.md for architecture-specific considerations
#
# x86-64 (Intel/AMD):
#   Standard_D2s_v3    - 2 vCPU, 8GB RAM   ~$24/month spot
#   Standard_D2as_v4   - 2 vCPU, 8GB RAM   ~$19/month spot (AMD)
#   Standard_F2s_v2    - 2 vCPU, 4GB RAM   ~$18/month spot (CPU-optimized)
#
# ARM64 (Ampere Altra):
#   Standard_D2ps_v5   - 2 vCPU, 8GB RAM   ~$12/month spot (50% savings!)
#   Standard_D4ps_v5   - 4 vCPU, 16GB RAM  ~$24/month spot (50% savings!)
#   Standard_E2ps_v5   - 2 vCPU, 16GB RAM  ~$14/month spot (memory-optimized)
#
# All Docker images support both architectures automatically
# ============================================================================
vm_sku             = "Standard_D2s_v3" # 2 vCPU, 8 GB RAM
use_spot_instances = true
spot_max_price     = -1 # Pay up to on-demand price

# Scaling Configuration
min_instances     = 0  # Scale to zero when idle
max_instances     = 10
default_instances = 1

# Runner Configuration
runner_count_per_vm = 0 # 0 = auto-detect based on vCPU count

# Docker Image Configuration
# ============================================================================
# See DOCKER_IMAGES.md for complete profile documentation and cost analysis
#
# Available profiles:
#   latest     - Alias for 'full' (production default)
#   full       - Complete IaC toolchain (Terraform, OpenTofu, Terraspace, cloud CLIs, K8s, PowerShell) ~2.8GB
#   minimal    - Bare minimum (Git + sudo only, no Docker) ~400MB - ideal for compiled languages
#   k8s        - Kubernetes tools (kubectl, helm, kustomize, kubelogin) + Docker ~1.5GB
#   iac        - Infrastructure as Code (Terraform, OpenTofu, Terraspace, cloud CLIs) + Docker ~2.0GB
#   iac-pwsh   - IaC + PowerShell (adds Azure/AWS PowerShell modules) ~2.3GB
#
# Multi-architecture: Both x86-64 and ARM64 automatically detected
# Cost impact: Smaller profiles = faster startup + lower storage costs
#
# Examples by use case:
#   "fok666/github-runner:full"     - Production (comprehensive tooling)
#   "fok666/github-runner:minimal"  - Cost-optimized (simple builds, Go/Rust projects)
#   "fok666/github-runner:k8s"      - Kubernetes deployments and GitOps
#   "fok666/github-runner:iac"      - Terraform/OpenTofu without PowerShell
#   "fok666/github-runner:iac-pwsh" - Terraform/OpenTofu with PowerShell automation
# ============================================================================
docker_image = "fok666/github-runner:latest"

# Storage
os_disk_size_gb = 100
os_disk_type    = "StandardSSD_LRS"

# Tags
tags = {
  Environment = "Production"
  Application = "GitHub-Runner"
  ManagedBy   = "Terraform"
  Team        = "DevOps"
}

# =============================================================================
# Production Features (Optional)
# =============================================================================

# Distributed Caching - Shared cache across ephemeral runners
# Significantly improves build performance (2-5x faster)
# Requires Azure Storage Account and container
# Cost: ~$2-10/month for typical usage
# enable_distributed_cache       = true
# cache_storage_account_name     = "myghcachestorage"
# cache_storage_container_name   = "runner-cache"
# cache_storage_account_key      = "storage-account-key-here"
# cache_shared                   = true

# Centralized Logging - Log Analytics integration
# Essential for troubleshooting ephemeral runners
# Requires Log Analytics workspace
# Cost: ~$10-40/month for typical usage
# enable_centralized_logging   = true
# log_analytics_workspace_id   = "/subscriptions/.../workspaces/my-workspace"
# log_analytics_workspace_key  = "workspace-key-here"
# log_retention_days           = 30

# Runner Monitoring - Prometheus metrics endpoint
# Track job success rate, duration, queue depth
# Requires network security rule for metrics port
# Cost: Minimal (included in infrastructure)
# enable_runner_monitoring = true
# metrics_port             = 9090
