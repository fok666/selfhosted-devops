# Example terraform.tfvars for GitLab Runner on Azure

project_name = "my-gitlab-runner"
location     = "East US"

# GitLab Configuration
gitlab_url   = "https://gitlab.com"
gitlab_token = "glrt-your-registration-token-here" # Get from GitLab: Settings > CI/CD > Runners
runner_tags  = "docker,linux,azure,spot"

# VM Configuration
# ============================================================================
# ARM64 (Ampere Altra) instances offer up to 50% cost savings vs x86-64
# See DOCKER_IMAGES.md for architecture-specific considerations
#
# x86-64 (Intel/AMD):
#   Standard_D2s_v3    - 2 vCPU, 8GB RAM   ~$24/month spot
#   Standard_D2as_v4   - 2 vCPU, 8GB RAM   ~$19/month spot (AMD)
#   Standard_F2s_v2    - 2 vCPU, 4GB RAM   ~$18/month spot (CPU-optimized)
#
# ARM64 (Ampere Altra):
#   Standard_D2ps_v5   - 2 vCPU, 8GB RAM   ~$12/month spot (50% savings!)
#   Standard_D4ps_v5   - 4 vCPU, 16GB RAM  ~$24/month spot (50% savings!)
#   Standard_E2ps_v5   - 2 vCPU, 16GB RAM  ~$14/month spot (memory-optimized)
#
# All Docker images support both architectures automatically
# ============================================================================
vm_sku             = "Standard_D2s_v3" # 2 vCPU, 8 GB RAM
use_spot_instances = true
spot_max_price     = -1 # Pay up to on-demand price

# Scaling Configuration
min_instances     = 0  # Scale to zero when idle
max_instances     = 10
default_instances = 1

# Runner Configuration
runner_count_per_vm = 0 # 0 = auto-detect based on vCPU count

# Docker Image Configuration
# ============================================================================
# See DOCKER_IMAGES.md for complete image variant documentation and cost analysis
#
# Available variants:
#   latest  - Full toolchain (Docker, Node.js, Python, Go, Rust, Cloud tools) ~2.5GB
#   minimal - Docker + Git only (cost-optimized) ~500MB
#   node    - Docker + Node.js + npm/yarn ~1.2GB
#   python  - Docker + Python 3.11 + pip/poetry ~1.1GB
#   golang  - Docker + Go 1.21 ~1.3GB
#   cloud   - Docker + AWS CLI + Azure CLI + kubectl ~1.8GB
#
# Multi-architecture support: Both x86-64 and ARM64 automatically detected
# Cost impact: Smaller images = faster startup + lower storage costs
#
# Examples:
#   "fok666/gitlab-runner:latest"  - Production workloads (full tools)
#   "fok666/gitlab-runner:minimal" - Cost-optimized (simple builds)
#   "fok666/gitlab-runner:node"    - JavaScript/TypeScript projects
#   "fok666/gitlab-runner:cloud"   - Kubernetes/IaC deployments
#   "fok666/gitlab-runner:1.2.3"   - Pin to specific version (production)
# ============================================================================
docker_image = "fok666/gitlab-runner:latest"

# Storage
os_disk_size_gb = 100
os_disk_type    = "StandardSSD_LRS"

# =============================================================================
# Optional: Distributed Caching (RECOMMENDED for Production)
# =============================================================================

# Uncomment to enable distributed cache for faster builds
# enable_distributed_cache     = true
# cache_type                   = "azurerm"
# cache_shared                 = true
# cache_storage_account_name   = "mycompanyrunnercache" # Must be globally unique
# cache_storage_container_name = "runner-cache"
# cache_storage_account_key    = "your-storage-account-key" # Leave empty to use Managed Identity

# =============================================================================
# Optional: Centralized Logging (RECOMMENDED for Production)
# =============================================================================

# Uncomment to enable centralized logging to Azure Log Analytics
# enable_centralized_logging  = true
# log_analytics_workspace_id  = "/subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.OperationalInsights/workspaces/{workspace}"
# log_analytics_workspace_key = "your-workspace-key"
# log_retention_days          = 30

# =============================================================================
# Optional: Runner Monitoring (RECOMMENDED for Production)
# =============================================================================

# Uncomment to enable Prometheus metrics for monitoring
# enable_runner_monitoring = true
# metrics_port             = 9252

# Tags
tags = {
  Environment = "Production"
  Application = "GitLab-Runner"
  ManagedBy   = "Terraform"
  Team        = "DevOps"
}
